<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.llbt.cms.dao.TransactionLimitMapper">
	<!-- 查询结果映射 -->
	<resultMap id="searchResultMap" type="com.llbt.cms.entity.TransactionLimit">
		<result property="id" column="ID" />
		<result property="createBy" column="CREATE_BY" />
		<result property="createDate" column="CREATE_DATE" />
		<result property="updateBy" column="UPDATE_BY" />
		<result property="updateDate" column="UPDATE_DATE" />
		<result property="serviceId" column="SERVICE_ID" />
		<result property="limitType" column="LIMIT_TYPE" />
		<result property="limitAmount" column="LIMIT_AMOUNT" />
		<result property="isDelete" column="IS_DELETE" />
		<result property="currency" column="CURRENCY" />
		<result property="serviceName" column="service_name" />
	</resultMap>
	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
		ID,CREATE_BY,CREATE_DATE,UPDATE_BY,UPDATE_DATE,SERVICE_ID,LIMIT_TYPE,LIMIT_AMOUNT,IS_DELETE,CURRENCY
	</sql>
	<!-- 新增记录 -->
	<insert id="insert" parameterType="com.llbt.cms.entity.TransactionLimit">
		INSERT INTO
		MMS_TRANSACTION_LIMIT (
		ID ,
		CREATE_BY ,
		CREATE_DATE ,
		UPDATE_BY ,
		UPDATE_DATE ,
		SERVICE_ID ,
		LIMIT_TYPE ,
		LIMIT_AMOUNT ,
		IS_DELETE ,
		CURRENCY
		) VALUES (
		#{id},
		#{createBy},
		#{createDate},
		#{updateBy},
		#{updateDate},
		#{serviceId},
		#{limitType},
		#{limitAmount},
		#{isDelete},
		#{currency}
		)
	</insert>
	<!-- 单记录删除 -->
	<delete id="delete" parameterType="java.lang.String">
		update MMS_TRANSACTION_LIMIT
		set
		is_delete=1
		where id=#{id}
	</delete>
	<!-- 批量记录删除 -->
	<delete id="deleteByIds" parameterType="java.util.List">
		update MMS_TRANSACTION_LIMIT set is_delete=1 where id in
		<foreach collection="list" item="ids" open="(" separator=","
			close=")">#{ids}</foreach>
	</delete>
	<!-- 单记录更新 -->
	<update id="update" parameterType="com.llbt.cms.entity.TransactionLimit">
		UPDATE MMS_TRANSACTION_LIMIT
		<trim prefix="set" suffixOverrides=",">
			<if test="updateBy != null">
				UPDATE_BY =#{updateBy},
			</if>
			<if test="updateDate != null">
				UPDATE_DATE =#{updateDate},
			</if>
			<if test="serviceId != null">
				SERVICE_ID =#{serviceId},
			</if>
			<if test="limitType != null">
				LIMIT_TYPE =#{limitType},
			</if>
			<if test="limitAmount != null">
				LIMIT_AMOUNT =#{limitAmount},
			</if>
			<if test="isDelete != null">
				IS_DELETE =#{isDelete},
			</if>
			<if test="currency != null">
				CURRENCY =#{currency},
			</if>
		</trim>
		where id=#{id}
	</update>
	<!-- 查询记录BY ID -->
	<select id="getById" resultMap="searchResultMap" parameterType="java.lang.String">
		select
		<include refid="columns" />
		from
		MMS_TRANSACTION_LIMIT where id=#{id}
	</select>
	<!-- 查询所有记录 -->
	<select id="getAll" resultMap="searchResultMap" parameterType="java.lang.String">
		select
		<include refid="columns" />
		from
		MMS_TRANSACTION_LIMIT where is_delete=0 order by create_date desc
	</select>
	<!-- 查询分页记录 -->
	<select id="queryPage" resultMap="searchResultMap"
		parameterType="com.llbt.cms.vo.Page">
		select *
		from (select rownum rw, t.*
		from (select
		<include refid="columns" />
		from MMS_TRANSACTION_LIMIT where is_delete=0 order by create_date
		desc) t
		where rownum <![CDATA[<=]]>
		#{endLine})
		where rw <![CDATA[>]]>
		#{startLine}
	</select>

	<select id="getTransactionLimitCount" resultType="int">
		select count(1)
		from MMS_TRANSACTION_LIMIT where is_delete=0
	</select>
	<!-- 动态查询条件 -->
	<sql id="searchConditionSQL">
		<trim prefix="where" prefixOverrides="AND |OR ">
			<if test="id != null">
				and ID = #{id}
			</if>
			<if test="createBy != null">
				and CREATE_BY = #{createBy}
			</if>
			<if test="createDate != null">
				and CREATE_DATE = #{createDate}
			</if>
			<if test="updateBy != null">
				and UPDATE_BY = #{updateBy}
			</if>
			<if test="updateDate != null">
				and UPDATE_DATE = #{updateDate}
			</if>
			<if test="serviceId != null">
				and SERVICE_ID = #{serviceId}
			</if>
			<if test="limitType != null">
				and LIMIT_TYPE = #{limitType}
			</if>
			<if test="limitAmount != null">
				and LIMIT_AMOUNT = #{limitAmount}
			</if>
			<if test="isDelete != null">
				and IS_DELETE = #{isDelete}
			</if>
			<if test="currency != null">
				and CURRENCY = #{currency}
			</if>
		</trim>
	</sql>

	<select id="getLimitListByServiceId" parameterType="java.lang.String"
		resultMap="searchResultMap">
		select
		 t.ID,
		 t.CREATE_BY,
		 t.CREATE_DATE,
		 t.UPDATE_BY,
		 t.UPDATE_DATE,
		 t.SERVICE_ID,
		 t.LIMIT_TYPE,
		 t.LIMIT_AMOUNT,
		 t.IS_DELETE,
		 t.CURRENCY
		,s.service_name
		from MMS_TRANSACTION_LIMIT t left join mms_system_service s on t.service_id = s.id
		where t.IS_DELETE=0 
		<if test="_parameter != null">
				and t.service_Id = #{serviceId}
		</if>
		Order By t.CREATE_DATE Desc
	</select> 

	
	<select id="countBusinessCurrency" parameterType="com.llbt.cms.entity.TransactionLimit"
		resultType="int">
		select count(1) from MMS_TRANSACTION_LIMIT where IS_DELETE=0 and
		SERVICE_ID=#{serviceId} and currency=#{currency}
	</select>

</mapper>