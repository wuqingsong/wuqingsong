<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.llbt.cms.dao.DeviceBindMapper">
	<resultMap id="searchResultMap" type="HashMap">
		<result property="id" column="id" />
		<result property="msisdn" column="MSISDN" />
		<result property="userName" column="USER_NAME" />
		<result property="bindState" column="BIND_STATE" />
		<result property="createDate" column="CREATE_DATE" />
		<result property="imei" column="IMEI" />
		<result property="phoneModel" column="PHONE_MODEL" />
		<result property="phoneSystem" column="PHONE_SYSTEM" />
	</resultMap>
	<select id="getDevice" resultMap="searchResultMap">
		SELECT
		c.id,
		c.msisdn,
		c.user_name,
		IFNULL(DATE_FORMAT(b.create_date, '%Y-%m-%d %H:%i:%S'),' ') create_date,
		IFNULL(b.bind_state, ' ') bind_state,
		IFNULL (b.imei, ' ') imei,
		IFNULL(b.phone_model, ' ') phone_model,
		IFNULL(b.phone_system, ' ') phone_system
		FROM
		MGATE_CUSTOMER c
		LEFT JOIN MGATE_DEVICE_BIND b ON c.id = b.user_id
		AND b.BIND_STATE = 1
		WHERE
		c.ACCOUNT_STATUS = 0
		AND ACCOUNT_STATUS != 1
		AND msisdn =#{phone}
		<!-- SELECT c.id,c.msisdn,c.user_name, nvl(to_char(b.create_date,'yyyy-mm-dd 
			HH24:mi:ss'),' ') create_date ,nvl(b.bind_state,' ') bind_state,nvl(b.imei,' 
			') imei,nvl(b.phone_model,' ') phone_model,nvl(b.phone_system,' ') phone_system 
			FROM MGATE_CUSTOMER c left join MGATE_DEVICE_BIND b on c.id=b.user_id and 
			b.BIND_STATE=1 WHERE c.ACCOUNT_STATUS = 0 and ACCOUNT_STATUS !=1 and msisdn 
			= #{phone} -->
	</select>
	<select id="getAdmin" resultMap="searchResultMap">
	SELECT
		c.id,c.msisdn,c.user_name,
		IFNULL(DATE_FORMAT(b.create_date, '%Y-%m-%d %H:%i:%S'),' ') create_date,
		IFNULL(b.bind_state,' ')
		bind_state,IFNULL(b.imei,' ') imei,IFNULL(b.phone_model,' ')
		phone_model,IFNULL(b.phone_system,' ') phone_system
		FROM
		MGATE_ADMIN c left
		join MGATE_DEVICE_BIND b on c.id=b.user_id and b.BIND_STATE=1
		WHERE
		c.ACCOUNT_STATUS = 0 and ACCOUNT_STATUS !=1 and msisdn =#{phone}
	<!-- SELECT c.id,c.msisdn,c.user_name, nvl(to_char(b.create_date,'yyyy-mm-dd 
		HH24:mi:ss'),' ') create_date ,nvl(b.bind_state,' ') bind_state,nvl(b.imei,' 
		') imei,nvl(b.phone_model,' ') phone_model,nvl(b.phone_system,' ') phone_system 
		FROM MGATE_ADMIN c left join MGATE_DEVICE_BIND b on c.id=b.user_id and b.BIND_STATE=1 
		WHERE c.ACCOUNT_STATUS = 0 and ACCOUNT_STATUS !=1 and msisdn = #{phone} -->
	</select>
	<select id="updDeviceBind" resultMap="searchResultMap">
		update mgate_device_bind
		set UPDATE_DATE = #{bindData},UPDATE_BY=#{userId},bind_state = 0 where
		user_id=#{id} and bind_state = '1'
	</select>
</mapper>